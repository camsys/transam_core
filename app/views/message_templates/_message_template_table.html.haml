:ruby
  table_dom_id = SecureRandom.hex


#table_actions.btn-group
  - if can? :create, MessageTemplate
    = link_to new_message_template_path, :class => 'btn btn-primary' do
      %i.fa.fa-plus.fa-fw
      = " Add New Message Template";

= javascript_include_tag  "https://kit.fontawesome.com/#{ENV['FONT_AWESOME']}.js"
.library-table
  %table.elbat{:id => table_dom_id,
    :use => 'true',
    :data => {:use => 'true',
      :table_code => 'message_templates',
      :side => 'client',
      :current_page => '0',
      :current_page_size => '10',
      :page_sizes => "10,20,50,100",
      :search => 'client',
      :export => "['csv', 'txt', 'excel']",
      :columns => '{"id":{"name":"ID","type":"drilldown-link"},
                    "1":{"name":"Subject"},
                    "2":{"name":"Description"},
                    "3":{"name":"Active","type":"checkmark-column"},
                    "4":{"name":"Message","type":"checkmark-column"},
                    "5":{"name":"Email (External)","type":"checkmark-column"},
                    "6":{"name":"Actions","type":"action-column"}}',
      :selected_columns => "id,1,2,3,4,5,6",
      :cookies => "true",
      :sort => 'client',
      :params => "{}",
      :filter => "[]",
      :data_source => 'client',
      :url => ''}}
  - @message_templates.each_with_index do |t, index|
    %div.actions
      - if can? :destroy, t
        = link_to message_template_path(t), :method => :delete, title: "Remove template", :data => {:confirm => "Are you sure you want to remove this template (#{t.name})? The action can't be undone."} do
          %i.fa.fa-trash-o.fa-fw.fa-2x


    :javascript
      add_row('#{table_dom_id}',
      {                  
        "id": '#{h link_to t.name, edit_message_template_path(t) }',
        "1": '#{h t.subject }',
        "2": "#{h t.description }",
        "3": "#{h format_as_boolean((t.active && t.is_implemented)) }",
        "4": "#{h format_as_boolean(t.message_enabled) }",
        "5": "#{h format_as_boolean(t.email_enabled) }",
      }, #{index});
      // TEMP UNTIL WE DO THIS FOR REAL
      // TODO: PLEASE DON'T LET THIS GO TO PRODUCTION
      // HACKY HACK IS HACKY
      add_aux_queue('#{table_dom_id}',()=>$(".actions").eq(#{index}).detach().appendTo($("##{table_dom_id} .action-column").eq(#{index}).find(".cell-text")));


-# %legend{style: 'border-bottom: none; margin-bottom: 0px;'} Message Templates

-# .table-responsive
-#   #table_actions.btn-group
-#     - if can? :create, MessageTemplate
-#       = link_to new_message_template_path, :class => 'btn btn-primary' do
-#         %i.fa.fa-plus.fa-fw
-#         = " Add New Message Template";
-#   %table.table.table-hover{:id => table_dom_id, :data => {:toggle => 'table',
-#     :pagination => 'true',
-#     :show_pagination_switch => 'false',
-#     :page_list => "[5, 10, 20, 50, 100, 200, 10000]",
-#     :page_size => current_user.num_table_rows,
-#     :search => 'false',
-#     :toolbar => "#table_actions",
-#     :export_types => "['csv', 'txt', 'excel']",
-#     :show_export => 'true',
-#     :show_columns => 'false',
-#     :show_toggle => 'false',
-#     :cookie => 'true',
-#     :cookie_id_table => "message_templates_table",
-#     :cookie_expire => "1y"}}
-#     %thead
-#       %tr
-#         %th.center{:data => {:sortable => 'true'}} ID
-#         %th.center{:data => {:sortable => 'true'}} Subject
-#         %th.center{:data => {:sortable => 'true'}} Description
-#         %th.center{:data => {:sortable => 'true'}} Active
-#         %th.center{:data => {:sortable => 'true'}} Message
-#         %th.center{:data => {:sortable => 'true'}} Email (External)
-#         %th

-#     %tbody
-#       - @message_templates.each do |t|
-#         %tr
-#           %td
-#             - if can? :update, t
-#               = link_to t.name, edit_message_template_path(t)
-#             - else
-#               t.name

-#           %td.left= t.subject
-#           %td.left.nowrap= format_as_text(t.description)
-#           %td.center.nowrap{data: {tableexport: {value: "#{(t.active && t.is_implemented) ? 'Yes' : 'No'}"}}}= format_as_boolean((t.active && t.is_implemented))
-#           %td.center.nowrap{data: {tableexport: {value: "#{t.message_enabled ? 'Yes' : 'No'}"}}}= format_as_boolean(t.message_enabled)
-#           %td.center.nowrap{data: {tableexport: {value: "#{t.email_enabled ? 'Yes' : 'No'}"}}}= format_as_boolean(t.email_enabled)
-#           %td.center
-#             - if can? :destroy, t
-#               = link_to message_template_path(t), :method => :delete, title: "Remove template", :data => {:confirm => "Are you sure you want to remove this template (#{t.name})? The action can't be undone."} do
-#                 %i.fa.fa-trash-o.fa-fw.fa-2x
